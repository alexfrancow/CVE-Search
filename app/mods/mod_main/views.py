from flask import Blueprint, render_template
from flask import Flask, jsonify, Blueprint, render_template, request, flash, redirect, url_for

import requests
from bs4 import BeautifulSoup

from app.mods.mod_main.utils import nist_description, createCVEdb, loadCVEs, searchByCVE

# Flask blueprints
main_blueprint = Blueprint('main', __name__, template_folder='templates')
createcve_blueprint = Blueprint('createCVE', __name__, template_folder='templates')
getcveinfo_blueprint = Blueprint('getCVEinfo', __name__, template_folder='templates')
runCVE_blueprint = Blueprint('runCVE', __name__, template_folder='templates')
app = Flask(__name__)


@main_blueprint.route('/', methods= ['GET', 'POST'])
def main():
    cve = request.args.get('cve')
    description = ""
    if cve:
        description = searchByCVE(cve)

    try:
        rows = loadCVEs()
        print(rows)
    except:
        pass
    return render_template('index.html', rows=rows, cve=cve, description=description)


@createcve_blueprint.route('/createCVE', methods= ['POST'])
def createCVE():
    if request.method == 'POST':
        new_cve = request.form.get('cve')
    print(new_cve)
    createCVEdb(new_cve)
    return render_template('index.html', new_cve=new_cve)


@getcveinfo_blueprint.route('/getCVEinfo', methods= ['GET', 'POST'])
def getCVEinfo():
    cve = request.args.get('cve')
    if cve:
        print(cve)
    return render_template('index.html', cve=cve)


@runCVE_blueprint.route('/run', methods= ['GET', 'POST'])
def runCVE():
    cve = request.args.get('cve')
    if cve:
        print(cve)
        description = nist_description(cve)
        print(description)
    return render_template('index.html', cve=cve, description=description)


if __name__ == '__main__':
    app.run(debug= True)
